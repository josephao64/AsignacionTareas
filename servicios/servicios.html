<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gestión de Servicios</title>
    <!-- SweetAlert2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
    <!-- Enlace al archivo CSS -->
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Estilos básicos para los nuevos elementos */
        .manage-types-btn,
        .add-type-btn {
            margin-left: 10px;
            padding: 5px 10px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }

        .manage-types-btn:hover,
        .add-type-btn:hover {
            background-color: #0056b3;
        }

        /* Estilos para el Botón de Inicio y Navegación */
        .header {
            display: flex;
            justify-content: flex-end;
            padding: 10px 20px;
            background-color: #f4f4f4;
        }

        .nav-btn {
            padding: 8px 16px;
            background-color: #008CBA;
            border: none;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
        }

        .nav-btn:hover {
            background-color: #006f98;
        }

        /* Estilos para la tabla de tipos de servicio */
        #tiposServiciosTable {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        #tiposServiciosTable th,
        #tiposServiciosTable td {
            border: 1px solid #ddd;
            padding: 8px;
        }

        #tiposServiciosTable th {
            background-color: #f2f2f2;
            text-align: left;
        }

        /* Estilos para los botones de editar y eliminar en tipos de servicio */
        .editar-tipo-btn,
        .eliminar-tipo-btn {
            margin-right: 5px;
            padding: 5px 8px;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }

        .editar-tipo-btn {
            background-color: #28a745;
            color: white;
        }

        .editar-tipo-btn:hover {
            background-color: #218838;
        }

        .eliminar-tipo-btn {
            background-color: #dc3545;
            color: white;
        }

        .eliminar-tipo-btn:hover {
            background-color: #c82333;
        }

        /* Estilos para el modal de tipos de servicio */
        #tiposServiciosModal .modal-content {
            max-width: 600px;
        }

        /* Estilos adicionales para una mejor presentación */
        .servicio-container {
            display: flex;
            align-items: center;
        }

        .servicio-container select {
            flex: 1;
        }

        .servicio-container button {
            margin-left: 10px;
        }

        /* Estilos para botones de acción en la tabla */
        .ver-recibos-btn,
        .registrar-recibo-btn {
            margin-right: 5px;
            padding: 5px 8px;
            border: none;
            cursor: pointer;
            border-radius: 4px;
            background-color: #17a2b8;
            color: white;
        }

        .ver-recibos-btn:hover,
        .registrar-recibo-btn:hover {
            background-color: #138496;
        }

        /* Estilos para filas seleccionadas */
        .selected {
            background-color: #d1ecf1;
        }

        /* Estilos para estados de pago */
        .status-paid {
            color: green;
            font-weight: bold;
        }

        .status-pending {
            color: orange;
            font-weight: bold;
        }

        .status-none {
            color: red;
            font-weight: bold;
        }

        .estado-pagado {
            color: green;
            font-weight: bold;
        }

        .estado-pendiente {
            color: orange;
            font-weight: bold;
        }

        /* Estilos para los modales */
        .modal {
            display: none; /* Oculto por defecto */
            position: fixed; /* Fijo */
            z-index: 1; /* Por encima de todo */
            left: 0;
            top: 0;
            width: 100%; /* Ancho completo */
            height: 100%; /* Alto completo */
            overflow: auto; /* Habilitar scroll si es necesario */
            background-color: rgba(0,0,0,0.4); /* Fondo semitransparente */
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto; /* 5% desde arriba y centrado */
            padding: 20px;
            border: 1px solid #888;
            width: 80%; /* Ancho */
            border-radius: 8px;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
        }

        /* Estilos para formularios y tablas dentro de modales */
        #tipoServicioForm {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        #tipoServicioForm input {
            flex: 1;
            padding: 5px;
        }

        #tipoServicioForm button {
            padding: 5px 10px;
            background-color: #28a745;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }

        #tipoServicioForm button:hover {
            background-color: #218838;
        }

        /* Estilos para la lista de recibos */
        .mes-recibos {
            margin-bottom: 20px;
        }

        .recibo {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
            position: relative;
        }

        .botones-recibo {
            margin-top: 10px;
            display: flex;
            gap: 5px;
        }

        .editar-recibo-btn,
        .eliminar-recibo-btn,
        .registrar-pago-btn {
            padding: 5px 8px;
            border: none;
            cursor: pointer;
            border-radius: 4px;
            color: white;
        }

        .editar-recibo-btn {
            background-color: #007bff;
        }

        .editar-recibo-btn:hover {
            background-color: #0056b3;
        }

        .eliminar-recibo-btn {
            background-color: #dc3545;
        }

        .eliminar-recibo-btn:hover {
            background-color: #c82333;
        }

        .registrar-pago-btn {
            background-color: #28a745;
        }

        .registrar-pago-btn:hover {
            background-color: #218838;
        }

        /* Estilos para el selector de año */
        #yearSelector {
            width: 100px;
            margin-right: 10px;
        }

        /* Otros estilos existentes... */
    </style>
</head>
<body>
    <!-- Cabecera con Botones de Navegación -->
    <div class="header">
        <!-- Botón de Tareas -->
        <button id="tareasBtn" class="nav-btn" onclick="location.href='../index.html'">Tareas</button>
        <!-- Botón de Servicios -->
        <button id="serviciosBtn" class="nav-btn" onclick="location.href='servicios.html'">Servicios</button>
    </div>

    <div class="container">
        <h1>Gestión de Servicios</h1>
        
        <div class="table-controls">
            <div class="filters">
                <!-- Selector de Año -->
                <label for="yearSelector">Año:</label>
                <input type="number" id="yearSelector" min="2000" max="2100" step="1">

                <input type="text" id="searchInput" placeholder="Buscar servicios...">
                
                <select id="filterSucursal">
                    <option value="">Todas las Sucursales</option>
                    <option value="Jalapa">Jalapa</option>
                    <option value="Pinula">Pinula</option>
                    <option value="Zacapa">Zacapa</option>
                    <option value="Eskala">Eskala</option>
                    <option value="Poptun">Poptun</option>
                    <option value="Santa Elena">Santa Elena</option>
                </select>

                <div class="servicio-container">
                    <select id="filterServicio">
                        <option value="">Todos los Servicios</option>
                        <!-- Las opciones se cargarán dinámicamente desde Firestore -->
                    </select>
                    <button id="gestionarTiposServicioBtn" class="manage-types-btn">Gestionar Tipos de Servicio</button>
                </div>

                <select id="filterEstadoPago">
                    <option value="">Todos los Estados de Pago</option>
                    <option value="Pagado">Pagado</option>
                    <option value="Pendiente">Pendiente</option>
                </select>

                <input type="date" id="filterFechaDesde" placeholder="Fecha Desde">
                <input type="date" id="filterFechaHasta" placeholder="Fecha Hasta">

                <!-- Ordenamiento por fecha de pago y fecha de creación -->
                <select id="sortOrder">
                    <option value="fechaPagoAsc">Pago Más Reciente</option>
                    <option value="fechaPagoDesc">Pago Más Antiguo</option>
                    <option value="fechaCreacionDesc">Registro Más Reciente</option>
                    <option value="fechaCreacionAsc">Registro Más Antiguo</option>
                </select>
                
                <button id="resetFilters" class="reset-filters-btn">Resetear Filtros</button>
            </div>
            <div class="actions-buttons">
                <button id="editarBtn" disabled>Editar</button>
                <button id="eliminarBtn" disabled>Eliminar</button>
                <button class="add-task-btn" onclick="abrirModal()">Agregar Servicio</button>
            </div>
        </div>

        <table id="servicioTable">
            <thead>
                <tr>
                    <th>Sucursal</th>
                    <th>Servicio</th>
                    <th>Proveedor del Servicio</th>
                    <th>Ubicación</th>
                    <th>Tipo de Pago</th>
                    <th>Estado de Pago</th>
                    <!-- Columnas para cada mes -->
                    <th>Enero</th>
                    <th>Febrero</th>
                    <th>Marzo</th>
                    <th>Abril</th>
                    <th>Mayo</th>
                    <th>Junio</th>
                    <th>Julio</th>
                    <th>Agosto</th>
                    <th>Septiembre</th>
                    <th>Octubre</th>
                    <th>Noviembre</th>
                    <th>Diciembre</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                <!-- Los servicios se generarán aquí dinámicamente -->
            </tbody>
        </table>
    </div>

    <!-- Modal para Agregar/Editar Servicio -->
    <div id="servicioModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal()">&times;</span>
            <h2 id="modalTitle">Agregar Servicio</h2>
            <form id="servicioForm">
                <!-- Información del Servicio -->
                <fieldset>
                    <legend>Información del Servicio</legend>

                    <label for="sucursal">Sucursal:</label>
                    <select id="sucursal" required>
                        <option value="">Selecciona una sucursal</option>
                        <option value="Jalapa">Jalapa</option>
                        <option value="Pinula">Pinula</option>
                        <option value="Zacapa">Zacapa</option>
                        <option value="Eskala">Eskala</option>
                        <option value="Poptun">Poptun</option>
                        <option value="Santa Elena">Santa Elena</option>
                    </select>

                    <label for="servicio">Servicio:</label>
                    <div class="servicio-container">
                        <select id="servicio" required>
                            <option value="">Selecciona un servicio</option>
                            <!-- Las opciones se cargarán dinámicamente desde Firestore -->
                        </select>
                        <button type="button" id="agregarTipoServicioBtn" class="add-type-btn">Agregar Tipo</button>
                    </div>

                    <label for="ubicacion">Ubicación:</label>
                    <input type="text" id="ubicacion" required placeholder="Ubicación del Servicio">

                    <label for="tipoPago">Tipo de Pago:</label>
                    <select id="tipoPago" required>
                        <option value="">Selecciona el tipo de pago</option>
                        <option value="Fijo">Fijo</option>
                        <option value="Variable">Variable</option>
                    </select>

                    <!-- Campos que se mostrarán solo si el Tipo de Pago es "Fijo" -->
                    <div id="tipoPagoFijoFields" style="display: none;">
                        <label for="fechaPagoFijo">Fecha de Pago:</label>
                        <input type="date" id="fechaPagoFijo">

                        <label for="montoAPagar">Monto a Pagar:</label>
                        <input type="number" id="montoAPagar" min="0" step="0.01">
                    </div>
                </fieldset>

                <!-- Información del Proveedor del Servicio -->
                <fieldset>
                    <legend>Proveedor del Servicio</legend>

                    <label for="proveedorServicio">Proveedor del Servicio:</label>
                    <input type="text" id="proveedorServicio" required>
                </fieldset>

                <button type="submit">Guardar Servicio</button>
            </form>
        </div>
    </div>

    <!-- Modal para Registrar Recibo -->
    <div id="registrarReciboModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarReciboModal()">&times;</span>
            <h2>Registrar Recibo</h2>
            <form id="reciboForm">
                <!-- Información del Servicio Seleccionado -->
                <div id="servicioSeleccionado" class="servicio-seleccionado">
                    <label>Servicio:</label>
                    <span id="nombreServicio">-</span>
                </div>

                <label for="mesesARegistrar">Meses a Registrar Pago:</label>
                <div id="mesesARegistrar" class="checklist-meses">
                    <!-- Checklist de meses se generará aquí dinámicamente -->
                </div>

                <button type="button" id="confirmarMesesBtn">Confirmar Meses</button>
            </form>

            <!-- Formulario para ingresar detalles de cada mes seleccionado -->
            <form id="detalleReciboForm" style="display: none; margin-top: 20px;">
                <h3>Detalles de Pagos Seleccionados</h3>
                <div id="detallesPagosContainer">
                    <!-- Detalles de pagos se generarán aquí dinámicamente -->
                </div>
                <button type="submit">Registrar Recibos</button>
            </form>
        </div>
    </div>

    <!-- Modal para Ver Recibos -->
    <div id="verRecibosModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarVerRecibosModal()">&times;</span>
            <h2>Ver Recibos</h2>

            <!-- Checklist de Meses -->
            <div id="checklistMeses" class="checklist-meses">
                <!-- Checklist se generará aquí dinámicamente -->
            </div>

            <!-- Lista de Recibos por Mes -->
            <div id="listaRecibosPorMes" class="lista-recibos-por-mes">
                <!-- Recibos se generarán aquí dinámicamente -->
            </div>
        </div>
    </div>

    <!-- Modal para Gestionar Tipos de Servicio -->
    <div id="tiposServiciosModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarTiposServiciosModal()">&times;</span>
            <h2>Gestionar Tipos de Servicio</h2>
            <form id="tipoServicioForm">
                <input type="text" id="nuevoTipoServicio" placeholder="Nuevo Tipo de Servicio" required>
                <button type="submit">Agregar Tipo</button>
            </form>
            <table id="tiposServiciosTable">
                <thead>
                    <tr>
                        <th>Tipo de Servicio</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Tipos de servicio se cargarán aquí dinámicamente -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Enlace al archivo JS -->
    <script type="module" src="servicios.js"></script>
</body>
</html>
